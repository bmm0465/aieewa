"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/preprocess-pdfs/route";
exports.ids = ["app/api/preprocess-pdfs/route"];
exports.modules = {

/***/ "@langchain/openai":
/*!************************************!*\
  !*** external "@langchain/openai" ***!
  \************************************/
/***/ ((module) => {

module.exports = require("@langchain/openai");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpreprocess-pdfs%2Froute&page=%2Fapi%2Fpreprocess-pdfs%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpreprocess-pdfs%2Froute.ts&appDir=C%3A%5CUsers%5C%EA%B9%80%EB%AF%BC%EC%A0%9C%5CDocuments%5CDev%5Caieewa%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5C%EA%B9%80%EB%AF%BC%EC%A0%9C%5CDocuments%5CDev%5Caieewa&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpreprocess-pdfs%2Froute&page=%2Fapi%2Fpreprocess-pdfs%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpreprocess-pdfs%2Froute.ts&appDir=C%3A%5CUsers%5C%EA%B9%80%EB%AF%BC%EC%A0%9C%5CDocuments%5CDev%5Caieewa%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5C%EA%B9%80%EB%AF%BC%EC%A0%9C%5CDocuments%5CDev%5Caieewa&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_Documents_Dev_aieewa_app_api_preprocess_pdfs_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/preprocess-pdfs/route.ts */ \"(rsc)/./app/api/preprocess-pdfs/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/preprocess-pdfs/route\",\n        pathname: \"/api/preprocess-pdfs\",\n        filename: \"route\",\n        bundlePath: \"app/api/preprocess-pdfs/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\김민제\\\\Documents\\\\Dev\\\\aieewa\\\\app\\\\api\\\\preprocess-pdfs\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_Documents_Dev_aieewa_app_api_preprocess_pdfs_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/preprocess-pdfs/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwcmVwcm9jZXNzLXBkZnMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnByZXByb2Nlc3MtcGRmcyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnByZXByb2Nlc3MtcGRmcyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUMlRUElQjklODAlRUIlQUYlQkMlRUMlQTAlOUMlNUNEb2N1bWVudHMlNUNEZXYlNUNhaWVld2ElNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1QyVFQSVCOSU4MCVFQiVBRiVCQyVFQyVBMCU5QyU1Q0RvY3VtZW50cyU1Q0RldiU1Q2FpZWV3YSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUMyQjtBQUN4RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVHQUF1RztBQUMvRztBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzZKOztBQUU3SiIsInNvdXJjZXMiOlsid2VicGFjazovL2FpZWV3YS8/NTVkZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFzquYDrr7zsoJxcXFxcRG9jdW1lbnRzXFxcXERldlxcXFxhaWVld2FcXFxcYXBwXFxcXGFwaVxcXFxwcmVwcm9jZXNzLXBkZnNcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3ByZXByb2Nlc3MtcGRmcy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3ByZXByb2Nlc3MtcGRmc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvcHJlcHJvY2Vzcy1wZGZzL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxc6rmA66+87KCcXFxcXERvY3VtZW50c1xcXFxEZXZcXFxcYWllZXdhXFxcXGFwcFxcXFxhcGlcXFxccHJlcHJvY2Vzcy1wZGZzXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3ByZXByb2Nlc3MtcGRmcy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpreprocess-pdfs%2Froute&page=%2Fapi%2Fpreprocess-pdfs%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpreprocess-pdfs%2Froute.ts&appDir=C%3A%5CUsers%5C%EA%B9%80%EB%AF%BC%EC%A0%9C%5CDocuments%5CDev%5Caieewa%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5C%EA%B9%80%EB%AF%BC%EC%A0%9C%5CDocuments%5CDev%5Caieewa&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/preprocess-pdfs/route.ts":
/*!******************************************!*\
  !*** ./app/api/preprocess-pdfs/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./lib/supabase.ts\");\n/* harmony import */ var _lib_embeddings__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/embeddings */ \"(rsc)/./lib/embeddings.ts\");\n\n\n\n\nconst pdfParse = __webpack_require__(/*! pdf-parse */ \"(rsc)/./node_modules/pdf-parse/dist/cjs/index.cjs\");\n\n\nconst runtime = \"nodejs\";\nconst maxDuration = 300 // 5분으로 증가 (여러 PDF 처리 시간 고려)\n;\nconst dynamic = \"force-dynamic\";\n// 간단한 텍스트 스플리터 구현\nfunction splitText(text, chunkSize = 1000, chunkOverlap = 200) {\n    const chunks = [];\n    let start = 0;\n    while(start < text.length){\n        const end = Math.min(start + chunkSize, text.length);\n        let chunk = text.slice(start, end);\n        // 문장 경계에서 자르기 시도\n        if (end < text.length) {\n            const lastSentenceEnd = chunk.lastIndexOf(\".\");\n            const lastNewline = chunk.lastIndexOf(\"\\n\");\n            const lastBreak = Math.max(lastSentenceEnd, lastNewline);\n            if (lastBreak > start + chunkSize * 0.5) {\n                chunk = chunk.slice(0, lastBreak + 1);\n            }\n        }\n        chunks.push(chunk.trim());\n        start += chunk.length - chunkOverlap;\n        if (start >= text.length) break;\n        if (chunk.length <= chunkOverlap) start += chunkSize;\n    }\n    return chunks.filter((chunk)=>chunk.length > 0);\n}\nasync function POST(request) {\n    try {\n        console.log(\"기본 PDF 전처리 시작\");\n        // 환경 확인\n        const isProduction = \"development\" === \"production\";\n        const isVercel = process.env.VERCEL === \"1\";\n        console.log(\"환경 정보:\", {\n            isProduction,\n            isVercel\n        });\n        // pdf 폴더 경로 확인 (환경별로 다른 경로 시도)\n        let pdfFolderPath = \"\";\n        const possiblePaths = [\n            (0,path__WEBPACK_IMPORTED_MODULE_2__.join)(process.cwd(), \"public\", \"pdf\"),\n            (0,path__WEBPACK_IMPORTED_MODULE_2__.join)(process.cwd(), \"pdf\"),\n            (0,path__WEBPACK_IMPORTED_MODULE_2__.join)(process.cwd(), \"..\", \"pdf\") // Vercel 빌드 시 상위 폴더\n        ];\n        for (const path of possiblePaths){\n            if ((0,fs__WEBPACK_IMPORTED_MODULE_3__.existsSync)(path)) {\n                const files = await (0,fs_promises__WEBPACK_IMPORTED_MODULE_1__.readdir)(path);\n                const pdfFiles = files.filter((file)=>file.toLowerCase().endsWith(\".pdf\"));\n                if (pdfFiles.length > 0) {\n                    pdfFolderPath = path;\n                    break;\n                }\n            }\n        }\n        if (!pdfFolderPath) {\n            console.log(\"PDF 폴더를 찾을 수 없습니다. 가능한 경로들:\", possiblePaths);\n            // 프로덕션 환경에서는 기본 문서가 이미 데이터베이스에 있다고 가정\n            if (isProduction) {\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    success: true,\n                    message: \"프로덕션 환경에서는 기본 문서들이 이미 준비되어 있습니다.\",\n                    totalFiles: 0,\n                    results: [],\n                    summary: {\n                        success: 0,\n                        failed: 0,\n                        skipped: 0\n                    }\n                });\n            }\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"pdf 폴더를 찾을 수 없습니다. 로컬 환경에서는 pdf/ 폴더에 파일을 넣어주세요.\"\n            }, {\n                status: 404\n            });\n        }\n        // PDF 파일 목록 가져오기\n        const files = await (0,fs_promises__WEBPACK_IMPORTED_MODULE_1__.readdir)(pdfFolderPath);\n        const pdfFiles = files.filter((file)=>file.toLowerCase().endsWith(\".pdf\"));\n        console.log(`발견된 PDF 파일: ${pdfFiles.length}개`, pdfFiles);\n        // Supabase 클라이언트 초기화\n        const supabase = (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_4__.getServerSupabaseClient)();\n        // 기존 기본 문서들 정리 (선택사항)\n        const isForceRefresh = request.nextUrl.searchParams.get(\"force\") === \"true\";\n        if (isForceRefresh) {\n            console.log(\"기존 기본 문서들 정리 중...\");\n            // 기본 문서들 삭제 (filename이 'pdf/' 접두사를 가진 것들)\n            await supabase.from(\"document_chunks\").delete().like(\"metadata->>source\", \"pdf/%\");\n            const { data: defaultDocs } = await supabase.from(\"documents\").select(\"id\").like(\"filename\", \"pdf/%\");\n            if (defaultDocs && defaultDocs.length > 0) {\n                const docIds = defaultDocs.map((doc)=>doc.id);\n                await supabase.from(\"documents\").delete().in(\"id\", docIds);\n            }\n        }\n        const results = [];\n        // 각 PDF 파일 처리\n        for (const filename of pdfFiles){\n            try {\n                console.log(`처리 중: ${filename}`);\n                const filePath = (0,path__WEBPACK_IMPORTED_MODULE_2__.join)(pdfFolderPath, filename);\n                const fileBuffer = await (0,fs_promises__WEBPACK_IMPORTED_MODULE_1__.readFile)(filePath);\n                // PDF 파싱\n                const pdfData = await pdfParse(fileBuffer);\n                const text = pdfData.text;\n                if (!text || text.trim().length === 0) {\n                    console.warn(`${filename}: 텍스트를 추출할 수 없습니다.`);\n                    results.push({\n                        filename,\n                        status: \"failed\",\n                        reason: \"텍스트 추출 불가\"\n                    });\n                    continue;\n                }\n                // 텍스트 청킹\n                const chunks = splitText(text, 1000, 200);\n                console.log(`${filename}: ${chunks.length}개 청크 생성`);\n                // 기존에 같은 파일이 처리되었는지 확인\n                const { data: existingDoc } = await supabase.from(\"documents\").select(\"id\").eq(\"filename\", `pdf/${filename}`).single();\n                if (existingDoc && !isForceRefresh) {\n                    console.log(`${filename}: 이미 처리된 파일입니다. 건너뜀`);\n                    results.push({\n                        filename,\n                        status: \"skipped\",\n                        reason: \"이미 처리됨\"\n                    });\n                    continue;\n                }\n                // 문서 정보 저장\n                const { data: docData, error: docError } = await supabase.from(\"documents\").upsert({\n                    filename: `pdf/${filename}`,\n                    file_size: fileBuffer.length,\n                    text_content: text.substring(0, 10000),\n                    chunk_count: chunks.length,\n                    upload_time: new Date().toISOString()\n                }, {\n                    onConflict: \"filename\"\n                }).select().single();\n                if (docError) {\n                    console.error(`${filename} 문서 저장 오류:`, docError);\n                    results.push({\n                        filename,\n                        status: \"failed\",\n                        reason: `문서 저장 실패: ${docError.message}`\n                    });\n                    continue;\n                }\n                console.log(`${filename} 문서 저장 완료:`, docData.id);\n                // 기존 청크들 삭제 (업데이트인 경우)\n                if (existingDoc || isForceRefresh) {\n                    await supabase.from(\"document_chunks\").delete().eq(\"document_id\", docData.id);\n                }\n                // 청크들 벡터 임베딩과 함께 저장\n                const chunksWithMetadata = chunks.map((chunk, index)=>({\n                        text: chunk,\n                        metadata: {\n                            source: `pdf/${filename}`,\n                            chunkIndex: index,\n                            uploadTime: new Date().toISOString(),\n                            isDefault: true\n                        },\n                        chunkIndex: index\n                    }));\n                // 벡터 임베딩 생성 및 저장\n                await (0,_lib_embeddings__WEBPACK_IMPORTED_MODULE_5__.processChunksWithEmbeddings)(chunksWithMetadata, docData.id);\n                console.log(`${filename}: ${chunks.length}개 청크 벡터 임베딩 저장 완료`);\n                results.push({\n                    filename,\n                    status: \"success\",\n                    chunks: chunks.length,\n                    textLength: text.length\n                });\n            } catch (error) {\n                console.error(`${filename} 처리 오류:`, error);\n                results.push({\n                    filename,\n                    status: \"failed\",\n                    reason: error instanceof Error ? error.message : \"알 수 없는 오류\"\n                });\n            }\n        }\n        const successCount = results.filter((r)=>r.status === \"success\").length;\n        const failedCount = results.filter((r)=>r.status === \"failed\").length;\n        const skippedCount = results.filter((r)=>r.status === \"skipped\").length;\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            message: `PDF 전처리 완료: 성공 ${successCount}개, 실패 ${failedCount}개, 건너뜀 ${skippedCount}개`,\n            totalFiles: pdfFiles.length,\n            results: results,\n            summary: {\n                success: successCount,\n                failed: failedCount,\n                skipped: skippedCount\n            }\n        });\n    } catch (error) {\n        console.error(\"PDF 전처리 전체 오류:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: `PDF 전처리에 실패했습니다: ${error instanceof Error ? error.message : \"알 수 없는 오류\"}`\n        }, {\n            status: 500\n        });\n    }\n}\n// 전처리 상태 확인을 위한 GET 엔드포인트\nasync function GET() {\n    try {\n        const supabase = (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_4__.getServerSupabaseClient)();\n        // 기본 문서들 조회\n        const { data: docs, error } = await supabase.from(\"documents\").select(\"id, filename, file_size, chunk_count, upload_time\").like(\"filename\", \"pdf/%\").order(\"upload_time\", {\n            ascending: false\n        });\n        if (error) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: `문서 조회 실패: ${error.message}`\n            }, {\n                status: 500\n            });\n        }\n        // 전체 청크 수 계산\n        const { data: chunksData } = await supabase.from(\"document_chunks\").select(\"document_id\").in(\"document_id\", docs?.map((doc)=>doc.id) || []);\n        const totalChunks = chunksData?.length || 0;\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            documents: docs || [],\n            totalDocuments: docs?.length || 0,\n            totalChunks: totalChunks\n        });\n    } catch (error) {\n        console.error(\"PDF 상태 조회 오류:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: `상태 조회 실패: ${error instanceof Error ? error.message : \"알 수 없는 오류\"}`\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TyxDQUFDLFVBQVUsRUFBRUEsaUJBQWlCOEMsUUFBUTlDLE1BQU1OLE9BQU8sR0FBRyxZQUFZLENBQUM7UUFBQyxHQUM3RTtZQUFFTyxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2FpZWV3YS8uL2FwcC9hcGkvcHJlcHJvY2Vzcy1wZGZzL3JvdXRlLnRzPzZlMjYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xyXG5pbXBvcnQgeyByZWFkZGlyLCByZWFkRmlsZSB9IGZyb20gJ2ZzL3Byb21pc2VzJ1xyXG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCdcclxuaW1wb3J0IHsgZXhpc3RzU3luYyB9IGZyb20gJ2ZzJ1xyXG5jb25zdCBwZGZQYXJzZSA9IHJlcXVpcmUoJ3BkZi1wYXJzZScpXHJcbmltcG9ydCB7IGdldFNlcnZlclN1cGFiYXNlQ2xpZW50IH0gZnJvbSAnQC9saWIvc3VwYWJhc2UnXHJcbmltcG9ydCB7IHByb2Nlc3NDaHVua3NXaXRoRW1iZWRkaW5ncyB9IGZyb20gJ0AvbGliL2VtYmVkZGluZ3MnXHJcblxyXG5leHBvcnQgY29uc3QgcnVudGltZSA9ICdub2RlanMnXHJcbmV4cG9ydCBjb25zdCBtYXhEdXJhdGlvbiA9IDMwMCAvLyA167aE7Jy866GcIOymneqwgCAo7Jes65+sIFBERiDsspjrpqwg7Iuc6rCEIOqzoOugpClcclxuZXhwb3J0IGNvbnN0IGR5bmFtaWMgPSAnZm9yY2UtZHluYW1pYydcclxuXHJcbi8vIOqwhOuLqO2VnCDthY3siqTtirgg7Iqk7ZSM66as7YSwIOq1rO2YhFxyXG5mdW5jdGlvbiBzcGxpdFRleHQodGV4dDogc3RyaW5nLCBjaHVua1NpemU6IG51bWJlciA9IDEwMDAsIGNodW5rT3ZlcmxhcDogbnVtYmVyID0gMjAwKTogc3RyaW5nW10ge1xyXG4gIGNvbnN0IGNodW5rczogc3RyaW5nW10gPSBbXVxyXG4gIGxldCBzdGFydCA9IDBcclxuICBcclxuICB3aGlsZSAoc3RhcnQgPCB0ZXh0Lmxlbmd0aCkge1xyXG4gICAgY29uc3QgZW5kID0gTWF0aC5taW4oc3RhcnQgKyBjaHVua1NpemUsIHRleHQubGVuZ3RoKVxyXG4gICAgbGV0IGNodW5rID0gdGV4dC5zbGljZShzdGFydCwgZW5kKVxyXG4gICAgXHJcbiAgICAvLyDrrLjsnqUg6rK96rOE7JeQ7IScIOyekOultOq4sCDsi5zrj4RcclxuICAgIGlmIChlbmQgPCB0ZXh0Lmxlbmd0aCkge1xyXG4gICAgICBjb25zdCBsYXN0U2VudGVuY2VFbmQgPSBjaHVuay5sYXN0SW5kZXhPZignLicpXHJcbiAgICAgIGNvbnN0IGxhc3ROZXdsaW5lID0gY2h1bmsubGFzdEluZGV4T2YoJ1xcbicpXHJcbiAgICAgIGNvbnN0IGxhc3RCcmVhayA9IE1hdGgubWF4KGxhc3RTZW50ZW5jZUVuZCwgbGFzdE5ld2xpbmUpXHJcbiAgICAgIFxyXG4gICAgICBpZiAobGFzdEJyZWFrID4gc3RhcnQgKyBjaHVua1NpemUgKiAwLjUpIHtcclxuICAgICAgICBjaHVuayA9IGNodW5rLnNsaWNlKDAsIGxhc3RCcmVhayArIDEpXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgY2h1bmtzLnB1c2goY2h1bmsudHJpbSgpKVxyXG4gICAgc3RhcnQgKz0gY2h1bmsubGVuZ3RoIC0gY2h1bmtPdmVybGFwXHJcbiAgICBcclxuICAgIGlmIChzdGFydCA+PSB0ZXh0Lmxlbmd0aCkgYnJlYWtcclxuICAgIGlmIChjaHVuay5sZW5ndGggPD0gY2h1bmtPdmVybGFwKSBzdGFydCArPSBjaHVua1NpemVcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIGNodW5rcy5maWx0ZXIoY2h1bmsgPT4gY2h1bmsubGVuZ3RoID4gMClcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ+q4sOuzuCBQREYg7KCE7LKY66asIOyLnOyekScpXHJcbiAgICBcclxuICAgIC8vIO2ZmOqyvSDtmZXsnbhcclxuICAgIGNvbnN0IGlzUHJvZHVjdGlvbiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbidcclxuICAgIGNvbnN0IGlzVmVyY2VsID0gcHJvY2Vzcy5lbnYuVkVSQ0VMID09PSAnMSdcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coJ+2ZmOqyvSDsoJXrs7Q6JywgeyBpc1Byb2R1Y3Rpb24sIGlzVmVyY2VsIH0pXHJcbiAgICBcclxuICAgIC8vIHBkZiDtj7TrjZQg6rK966GcIO2ZleyduCAo7ZmY6rK967OE66GcIOuLpOuluCDqsr3roZwg7Iuc64+EKVxyXG4gICAgbGV0IHBkZkZvbGRlclBhdGggPSAnJ1xyXG4gICAgY29uc3QgcG9zc2libGVQYXRocyA9IFtcclxuICAgICAgam9pbihwcm9jZXNzLmN3ZCgpLCAncHVibGljJywgJ3BkZicpLFxyXG4gICAgICBqb2luKHByb2Nlc3MuY3dkKCksICdwZGYnKSxcclxuICAgICAgam9pbihwcm9jZXNzLmN3ZCgpLCAnLi4nLCAncGRmJykgLy8gVmVyY2VsIOu5jOuTnCDsi5wg7IOB7JyEIO2PtOuNlFxyXG4gICAgXVxyXG4gICAgXHJcbiAgICBmb3IgKGNvbnN0IHBhdGggb2YgcG9zc2libGVQYXRocykge1xyXG4gICAgICBpZiAoZXhpc3RzU3luYyhwYXRoKSkge1xyXG4gICAgICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgcmVhZGRpcihwYXRoKVxyXG4gICAgICAgIGNvbnN0IHBkZkZpbGVzID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4gZmlsZS50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKCcucGRmJykpXHJcbiAgICAgICAgaWYgKHBkZkZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHBkZkZvbGRlclBhdGggPSBwYXRoXHJcbiAgICAgICAgICBicmVha1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoIXBkZkZvbGRlclBhdGgpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1BERiDtj7TrjZTrpbwg7LC+7J2EIOyImCDsl4bsirXri4jri6QuIOqwgOuKpe2VnCDqsr3roZzrk6Q6JywgcG9zc2libGVQYXRocylcclxuICAgICAgXHJcbiAgICAgIC8vIO2UhOuhnOuNleyFmCDtmZjqsr3sl5DshJzripQg6riw67O4IOusuOyEnOqwgCDsnbTrr7gg642w7J207YSw67Kg7J207Iqk7JeQIOyeiOuLpOqzoCDqsIDsoJVcclxuICAgICAgaWYgKGlzUHJvZHVjdGlvbikge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgbWVzc2FnZTogJ+2UhOuhnOuNleyFmCDtmZjqsr3sl5DshJzripQg6riw67O4IOusuOyEnOuTpOydtCDsnbTrr7gg7KSA67mE65CY7Ja0IOyeiOyKteuLiOuLpC4nLFxyXG4gICAgICAgICAgdG90YWxGaWxlczogMCxcclxuICAgICAgICAgIHJlc3VsdHM6IFtdLFxyXG4gICAgICAgICAgc3VtbWFyeTogeyBzdWNjZXNzOiAwLCBmYWlsZWQ6IDAsIHNraXBwZWQ6IDAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAncGRmIO2PtOuNlOulvCDssL7snYQg7IiYIOyXhuyKteuLiOuLpC4g66Gc7LusIO2ZmOqyveyXkOyEnOuKlCBwZGYvIO2PtOuNlOyXkCDtjIzsnbzsnYQg64Sj7Ja07KO87IS47JqULicgfSxcclxuICAgICAgICB7IHN0YXR1czogNDA0IH1cclxuICAgICAgKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFBERiDtjIzsnbwg66qp66GdIOqwgOyguOyYpOq4sFxyXG4gICAgY29uc3QgZmlsZXMgPSBhd2FpdCByZWFkZGlyKHBkZkZvbGRlclBhdGgpXHJcbiAgICBjb25zdCBwZGZGaWxlcyA9IGZpbGVzLmZpbHRlcihmaWxlID0+IGZpbGUudG9Mb3dlckNhc2UoKS5lbmRzV2l0aCgnLnBkZicpKVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGDrsJzqsqzrkJwgUERGIO2MjOydvDogJHtwZGZGaWxlcy5sZW5ndGh96rCcYCwgcGRmRmlsZXMpXHJcblxyXG4gICAgLy8gU3VwYWJhc2Ug7YG065287J207Ja47Yq4IOy0iOq4sO2ZlFxyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTZXJ2ZXJTdXBhYmFzZUNsaWVudCgpXHJcbiAgICBcclxuICAgIC8vIOq4sOyhtCDquLDrs7gg66y47ISc65OkIOygleumrCAo7ISg7YOd7IKs7ZWtKVxyXG4gICAgY29uc3QgaXNGb3JjZVJlZnJlc2ggPSByZXF1ZXN0Lm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnZm9yY2UnKSA9PT0gJ3RydWUnXHJcbiAgICBcclxuICAgIGlmIChpc0ZvcmNlUmVmcmVzaCkge1xyXG4gICAgICBjb25zb2xlLmxvZygn6riw7KG0IOq4sOuzuCDrrLjshJzrk6Qg7KCV66asIOykkS4uLicpXHJcbiAgICAgIC8vIOq4sOuzuCDrrLjshJzrk6Qg7IKt7KCcIChmaWxlbmFtZeydtCAncGRmLycg7KCR65GQ7IKs66W8IOqwgOynhCDqsoPrk6QpXHJcbiAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2RvY3VtZW50X2NodW5rcycpXHJcbiAgICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgICAgLmxpa2UoJ21ldGFkYXRhLT4+c291cmNlJywgJ3BkZi8lJylcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZGVmYXVsdERvY3MgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2RvY3VtZW50cycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgIC5saWtlKCdmaWxlbmFtZScsICdwZGYvJScpXHJcbiAgICAgIFxyXG4gICAgICBpZiAoZGVmYXVsdERvY3MgJiYgZGVmYXVsdERvY3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGRvY0lkcyA9IGRlZmF1bHREb2NzLm1hcChkb2MgPT4gZG9jLmlkKVxyXG4gICAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgnZG9jdW1lbnRzJylcclxuICAgICAgICAgIC5kZWxldGUoKVxyXG4gICAgICAgICAgLmluKCdpZCcsIGRvY0lkcylcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlc3VsdHMgPSBbXVxyXG5cclxuICAgIC8vIOqwgSBQREYg7YyM7J28IOyymOumrFxyXG4gICAgZm9yIChjb25zdCBmaWxlbmFtZSBvZiBwZGZGaWxlcykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGDsspjrpqwg7KSROiAke2ZpbGVuYW1lfWApXHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgZmlsZVBhdGggPSBqb2luKHBkZkZvbGRlclBhdGgsIGZpbGVuYW1lKVxyXG4gICAgICAgIGNvbnN0IGZpbGVCdWZmZXIgPSBhd2FpdCByZWFkRmlsZShmaWxlUGF0aClcclxuICAgICAgICBcclxuICAgICAgICAvLyBQREYg7YyM7IuxXHJcbiAgICAgICAgY29uc3QgcGRmRGF0YSA9IGF3YWl0IHBkZlBhcnNlKGZpbGVCdWZmZXIpXHJcbiAgICAgICAgY29uc3QgdGV4dCA9IHBkZkRhdGEudGV4dFxyXG5cclxuICAgICAgICBpZiAoIXRleHQgfHwgdGV4dC50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oYCR7ZmlsZW5hbWV9OiDthY3siqTtirjrpbwg7LaU7Lac7ZWgIOyImCDsl4bsirXri4jri6QuYClcclxuICAgICAgICAgIHJlc3VsdHMucHVzaCh7IGZpbGVuYW1lLCBzdGF0dXM6ICdmYWlsZWQnLCByZWFzb246ICfthY3siqTtirgg7LaU7LacIOu2iOqwgCcgfSlcclxuICAgICAgICAgIGNvbnRpbnVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDthY3siqTtirgg7LKt7YK5XHJcbiAgICAgICAgY29uc3QgY2h1bmtzID0gc3BsaXRUZXh0KHRleHQsIDEwMDAsIDIwMClcclxuICAgICAgICBjb25zb2xlLmxvZyhgJHtmaWxlbmFtZX06ICR7Y2h1bmtzLmxlbmd0aH3qsJwg7LKt7YGsIOyDneyEsWApXHJcblxyXG4gICAgICAgIC8vIOq4sOyhtOyXkCDqsJnsnYAg7YyM7J287J20IOyymOumrOuQmOyXiOuKlOyngCDtmZXsnbhcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nRG9jIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ2RvY3VtZW50cycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ2ZpbGVuYW1lJywgYHBkZi8ke2ZpbGVuYW1lfWApXHJcbiAgICAgICAgICAuc2luZ2xlKClcclxuXHJcbiAgICAgICAgaWYgKGV4aXN0aW5nRG9jICYmICFpc0ZvcmNlUmVmcmVzaCkge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coYCR7ZmlsZW5hbWV9OiDsnbTrr7gg7LKY66as65CcIO2MjOydvOyeheuLiOuLpC4g6rG064SI65yAYClcclxuICAgICAgICAgIHJlc3VsdHMucHVzaCh7IGZpbGVuYW1lLCBzdGF0dXM6ICdza2lwcGVkJywgcmVhc29uOiAn7J2066+4IOyymOumrOuQqCcgfSlcclxuICAgICAgICAgIGNvbnRpbnVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDrrLjshJwg7KCV67O0IOyggOyepVxyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZG9jRGF0YSwgZXJyb3I6IGRvY0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ2RvY3VtZW50cycpXHJcbiAgICAgICAgICAudXBzZXJ0KHtcclxuICAgICAgICAgICAgZmlsZW5hbWU6IGBwZGYvJHtmaWxlbmFtZX1gLFxyXG4gICAgICAgICAgICBmaWxlX3NpemU6IGZpbGVCdWZmZXIubGVuZ3RoLFxyXG4gICAgICAgICAgICB0ZXh0X2NvbnRlbnQ6IHRleHQuc3Vic3RyaW5nKDAsIDEwMDAwKSwgLy8g7LKY7J2MIDEwMDAw7J6Q66eMIOyggOyepVxyXG4gICAgICAgICAgICBjaHVua19jb3VudDogY2h1bmtzLmxlbmd0aCxcclxuICAgICAgICAgICAgdXBsb2FkX3RpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgb25Db25mbGljdDogJ2ZpbGVuYW1lJ1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgICAgLnNpbmdsZSgpXHJcblxyXG4gICAgICAgIGlmIChkb2NFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihgJHtmaWxlbmFtZX0g66y47IScIOyggOyepSDsmKTrpZg6YCwgZG9jRXJyb3IpXHJcbiAgICAgICAgICByZXN1bHRzLnB1c2goeyBmaWxlbmFtZSwgc3RhdHVzOiAnZmFpbGVkJywgcmVhc29uOiBg66y47IScIOyggOyepSDsi6TtjKg6ICR7ZG9jRXJyb3IubWVzc2FnZX1gIH0pXHJcbiAgICAgICAgICBjb250aW51ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coYCR7ZmlsZW5hbWV9IOusuOyEnCDsoIDsnqUg7JmE66OMOmAsIGRvY0RhdGEuaWQpXHJcblxyXG4gICAgICAgIC8vIOq4sOyhtCDssq3tgazrk6Qg7IKt7KCcICjsl4XrjbDsnbTtirjsnbgg6rK97JqwKVxyXG4gICAgICAgIGlmIChleGlzdGluZ0RvYyB8fCBpc0ZvcmNlUmVmcmVzaCkge1xyXG4gICAgICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgICAgLmZyb20oJ2RvY3VtZW50X2NodW5rcycpXHJcbiAgICAgICAgICAgIC5kZWxldGUoKVxyXG4gICAgICAgICAgICAuZXEoJ2RvY3VtZW50X2lkJywgZG9jRGF0YS5pZClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOyyre2BrOuTpCDrsqHthLAg7J6E67Kg65Sp6rO8IO2VqOq7mCDsoIDsnqVcclxuICAgICAgICBjb25zdCBjaHVua3NXaXRoTWV0YWRhdGEgPSBjaHVua3MubWFwKChjaHVuaywgaW5kZXgpID0+ICh7XHJcbiAgICAgICAgICB0ZXh0OiBjaHVuayxcclxuICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgIHNvdXJjZTogYHBkZi8ke2ZpbGVuYW1lfWAsXHJcbiAgICAgICAgICAgIGNodW5rSW5kZXg6IGluZGV4LFxyXG4gICAgICAgICAgICB1cGxvYWRUaW1lOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICAgIGlzRGVmYXVsdDogdHJ1ZVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNodW5rSW5kZXg6IGluZGV4XHJcbiAgICAgICAgfSkpXHJcblxyXG4gICAgICAgIC8vIOuyoe2EsCDsnoTrsqDrlKkg7IOd7ISxIOuwjyDsoIDsnqVcclxuICAgICAgICBhd2FpdCBwcm9jZXNzQ2h1bmtzV2l0aEVtYmVkZGluZ3MoY2h1bmtzV2l0aE1ldGFkYXRhLCBkb2NEYXRhLmlkKVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhgJHtmaWxlbmFtZX06ICR7Y2h1bmtzLmxlbmd0aH3qsJwg7LKt7YGsIOuyoe2EsCDsnoTrsqDrlKkg7KCA7J6lIOyZhOujjGApXHJcbiAgICAgICAgcmVzdWx0cy5wdXNoKHsgXHJcbiAgICAgICAgICBmaWxlbmFtZSwgXHJcbiAgICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJywgXHJcbiAgICAgICAgICBjaHVua3M6IGNodW5rcy5sZW5ndGgsXHJcbiAgICAgICAgICB0ZXh0TGVuZ3RoOiB0ZXh0Lmxlbmd0aCBcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGAke2ZpbGVuYW1lfSDsspjrpqwg7Jik66WYOmAsIGVycm9yKVxyXG4gICAgICAgIHJlc3VsdHMucHVzaCh7IFxyXG4gICAgICAgICAgZmlsZW5hbWUsIFxyXG4gICAgICAgICAgc3RhdHVzOiAnZmFpbGVkJywgXHJcbiAgICAgICAgICByZWFzb246IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+yVjCDsiJgg7JeG64qUIOyYpOulmCcgXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN1Y2Nlc3NDb3VudCA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5zdGF0dXMgPT09ICdzdWNjZXNzJykubGVuZ3RoXHJcbiAgICBjb25zdCBmYWlsZWRDb3VudCA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5zdGF0dXMgPT09ICdmYWlsZWQnKS5sZW5ndGhcclxuICAgIGNvbnN0IHNraXBwZWRDb3VudCA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5zdGF0dXMgPT09ICdza2lwcGVkJykubGVuZ3RoXHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogYFBERiDsoITsspjrpqwg7JmE66OMOiDshLHqs7UgJHtzdWNjZXNzQ291bnR96rCcLCDsi6TtjKggJHtmYWlsZWRDb3VudH3qsJwsIOqxtOuEiOucgCAke3NraXBwZWRDb3VudH3qsJxgLFxyXG4gICAgICB0b3RhbEZpbGVzOiBwZGZGaWxlcy5sZW5ndGgsXHJcbiAgICAgIHJlc3VsdHM6IHJlc3VsdHMsXHJcbiAgICAgIHN1bW1hcnk6IHtcclxuICAgICAgICBzdWNjZXNzOiBzdWNjZXNzQ291bnQsXHJcbiAgICAgICAgZmFpbGVkOiBmYWlsZWRDb3VudCxcclxuICAgICAgICBza2lwcGVkOiBza2lwcGVkQ291bnRcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1BERiDsoITsspjrpqwg7KCE7LK0IOyYpOulmDonLCBlcnJvcilcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBlcnJvcjogYFBERiDsoITsspjrpqzsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+yVjCDsiJgg7JeG64qUIOyYpOulmCd9YCB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgIClcclxuICB9XHJcbn1cclxuXHJcbi8vIOyghOyymOumrCDsg4Htg5wg7ZmV7J247J2EIOychO2VnCBHRVQg7JeU65Oc7Y+s7J247Yq4XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U2VydmVyU3VwYWJhc2VDbGllbnQoKVxyXG4gICAgXHJcbiAgICAvLyDquLDrs7gg66y47ISc65OkIOyhsO2ajFxyXG4gICAgY29uc3QgeyBkYXRhOiBkb2NzLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2RvY3VtZW50cycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBmaWxlbmFtZSwgZmlsZV9zaXplLCBjaHVua19jb3VudCwgdXBsb2FkX3RpbWUnKVxyXG4gICAgICAubGlrZSgnZmlsZW5hbWUnLCAncGRmLyUnKVxyXG4gICAgICAub3JkZXIoJ3VwbG9hZF90aW1lJywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiBg66y47IScIOyhsO2ajCDsi6TtjKg6ICR7ZXJyb3IubWVzc2FnZX1gIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICAvLyDsoITssrQg7LKt7YGsIOyImCDqs4TsgrBcclxuICAgIGNvbnN0IHsgZGF0YTogY2h1bmtzRGF0YSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2RvY3VtZW50X2NodW5rcycpXHJcbiAgICAgIC5zZWxlY3QoJ2RvY3VtZW50X2lkJylcclxuICAgICAgLmluKCdkb2N1bWVudF9pZCcsIGRvY3M/Lm1hcChkb2MgPT4gZG9jLmlkKSB8fCBbXSlcclxuXHJcbiAgICBjb25zdCB0b3RhbENodW5rcyA9IGNodW5rc0RhdGE/Lmxlbmd0aCB8fCAwXHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZG9jdW1lbnRzOiBkb2NzIHx8IFtdLFxyXG4gICAgICB0b3RhbERvY3VtZW50czogZG9jcz8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgIHRvdGFsQ2h1bmtzOiB0b3RhbENodW5rc1xyXG4gICAgfSlcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1BERiDsg4Htg5wg7KGw7ZqMIOyYpOulmDonLCBlcnJvcilcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBlcnJvcjogYOyDge2DnCDsobDtmowg7Iuk7YyoOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+yVjCDsiJgg7JeG64qUIOyYpOulmCd9YCB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgIClcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInJlYWRkaXIiLCJyZWFkRmlsZSIsImpvaW4iLCJleGlzdHNTeW5jIiwicGRmUGFyc2UiLCJyZXF1aXJlIiwiZ2V0U2VydmVyU3VwYWJhc2VDbGllbnQiLCJwcm9jZXNzQ2h1bmtzV2l0aEVtYmVkZGluZ3MiLCJydW50aW1lIiwibWF4RHVyYXRpb24iLCJkeW5hbWljIiwic3BsaXRUZXh0IiwidGV4dCIsImNodW5rU2l6ZSIsImNodW5rT3ZlcmxhcCIsImNodW5rcyIsInN0YXJ0IiwibGVuZ3RoIiwiZW5kIiwiTWF0aCIsIm1pbiIsImNodW5rIiwic2xpY2UiLCJsYXN0U2VudGVuY2VFbmQiLCJsYXN0SW5kZXhPZiIsImxhc3ROZXdsaW5lIiwibGFzdEJyZWFrIiwibWF4IiwicHVzaCIsInRyaW0iLCJmaWx0ZXIiLCJQT1NUIiwicmVxdWVzdCIsImNvbnNvbGUiLCJsb2ciLCJpc1Byb2R1Y3Rpb24iLCJwcm9jZXNzIiwiaXNWZXJjZWwiLCJlbnYiLCJWRVJDRUwiLCJwZGZGb2xkZXJQYXRoIiwicG9zc2libGVQYXRocyIsImN3ZCIsInBhdGgiLCJmaWxlcyIsInBkZkZpbGVzIiwiZmlsZSIsInRvTG93ZXJDYXNlIiwiZW5kc1dpdGgiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJ0b3RhbEZpbGVzIiwicmVzdWx0cyIsInN1bW1hcnkiLCJmYWlsZWQiLCJza2lwcGVkIiwiZXJyb3IiLCJzdGF0dXMiLCJzdXBhYmFzZSIsImlzRm9yY2VSZWZyZXNoIiwibmV4dFVybCIsInNlYXJjaFBhcmFtcyIsImdldCIsImZyb20iLCJkZWxldGUiLCJsaWtlIiwiZGF0YSIsImRlZmF1bHREb2NzIiwic2VsZWN0IiwiZG9jSWRzIiwibWFwIiwiZG9jIiwiaWQiLCJpbiIsImZpbGVuYW1lIiwiZmlsZVBhdGgiLCJmaWxlQnVmZmVyIiwicGRmRGF0YSIsIndhcm4iLCJyZWFzb24iLCJleGlzdGluZ0RvYyIsImVxIiwic2luZ2xlIiwiZG9jRGF0YSIsImRvY0Vycm9yIiwidXBzZXJ0IiwiZmlsZV9zaXplIiwidGV4dF9jb250ZW50Iiwic3Vic3RyaW5nIiwiY2h1bmtfY291bnQiLCJ1cGxvYWRfdGltZSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsIm9uQ29uZmxpY3QiLCJjaHVua3NXaXRoTWV0YWRhdGEiLCJpbmRleCIsIm1ldGFkYXRhIiwic291cmNlIiwiY2h1bmtJbmRleCIsInVwbG9hZFRpbWUiLCJpc0RlZmF1bHQiLCJ0ZXh0TGVuZ3RoIiwiRXJyb3IiLCJzdWNjZXNzQ291bnQiLCJyIiwiZmFpbGVkQ291bnQiLCJza2lwcGVkQ291bnQiLCJHRVQiLCJkb2NzIiwib3JkZXIiLCJhc2NlbmRpbmciLCJjaHVua3NEYXRhIiwidG90YWxDaHVua3MiLCJkb2N1bWVudHMiLCJ0b3RhbERvY3VtZW50cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/preprocess-pdfs/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/embeddings.ts":
/*!***************************!*\
  !*** ./lib/embeddings.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateEmbeddings: () => (/* binding */ generateEmbeddings),\n/* harmony export */   generateSingleEmbedding: () => (/* binding */ generateSingleEmbedding),\n/* harmony export */   processChunksWithEmbeddings: () => (/* binding */ processChunksWithEmbeddings),\n/* harmony export */   searchSimilarVectors: () => (/* binding */ searchSimilarVectors)\n/* harmony export */ });\n/* harmony import */ var _langchain_openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @langchain/openai */ \"@langchain/openai\");\n/* harmony import */ var _langchain_openai__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_langchain_openai__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./supabase */ \"(rsc)/./lib/supabase.ts\");\n\n\n// OpenAI Embeddings 클라이언트 초기화\nlet embeddingsClient = null;\nfunction getEmbeddingsClient() {\n    if (!embeddingsClient) {\n        if (!process.env.OPENAI_API_KEY) {\n            throw new Error(\"OPENAI_API_KEY 환경 변수가 설정되지 않았습니다.\");\n        }\n        embeddingsClient = new _langchain_openai__WEBPACK_IMPORTED_MODULE_0__.OpenAIEmbeddings({\n            openAIApiKey: process.env.OPENAI_API_KEY,\n            modelName: \"text-embedding-3-small\",\n            batchSize: 100\n        });\n    }\n    return embeddingsClient;\n}\n// 텍스트 청크들을 벡터 임베딩으로 변환\nasync function generateEmbeddings(texts) {\n    try {\n        console.log(`${texts.length}개 텍스트에 대한 임베딩 생성 시작`);\n        const client = getEmbeddingsClient();\n        const embeddings = await client.embedDocuments(texts);\n        console.log(`임베딩 생성 완료: ${embeddings.length}개 벡터`);\n        return embeddings;\n    } catch (error) {\n        console.error(\"임베딩 생성 오류:\", error);\n        throw new Error(`임베딩 생성에 실패했습니다: ${error instanceof Error ? error.message : \"알 수 없는 오류\"}`);\n    }\n}\n// 단일 텍스트에 대한 벡터 임베딩 생성\nasync function generateSingleEmbedding(text) {\n    try {\n        const client = getEmbeddingsClient();\n        const embedding = await client.embedQuery(text);\n        return embedding;\n    } catch (error) {\n        console.error(\"단일 임베딩 생성 오류:\", error);\n        throw new Error(`임베딩 생성에 실패했습니다: ${error instanceof Error ? error.message : \"알 수 없는 오류\"}`);\n    }\n}\n// 벡터 유사도 검색 (코사인 유사도)\nasync function searchSimilarVectors(queryEmbedding, limit = 10, threshold = 0.7) {\n    try {\n        const supabase = (0,_supabase__WEBPACK_IMPORTED_MODULE_1__.getServerSupabaseClient)();\n        // 모든 청크의 임베딩을 가져와서 유사도 계산\n        const { data: chunks, error } = await supabase.from(\"document_chunks\").select(\"chunk_text, metadata, embedding\").not(\"embedding\", \"is\", null);\n        if (error) {\n            console.error(\"청크 조회 오류:\", error);\n            return [];\n        }\n        if (!chunks || chunks.length === 0) {\n            console.log(\"임베딩된 청크가 없습니다.\");\n            return [];\n        }\n        // 코사인 유사도 계산\n        const similarities = chunks.map((chunk)=>{\n            if (!chunk.embedding || !Array.isArray(chunk.embedding)) {\n                return {\n                    ...chunk,\n                    similarity: 0\n                };\n            }\n            const similarity = cosineSimilarity(queryEmbedding, chunk.embedding);\n            return {\n                ...chunk,\n                similarity\n            };\n        });\n        // 유사도 순으로 정렬하고 임계값 이상만 반환\n        const results = similarities.filter((item)=>item.similarity >= threshold).sort((a, b)=>b.similarity - a.similarity).slice(0, limit);\n        console.log(`벡터 검색 결과: ${results.length}개 (임계값: ${threshold})`);\n        return results;\n    } catch (error) {\n        console.error(\"벡터 검색 오류:\", error);\n        return [];\n    }\n}\n// 코사인 유사도 계산 함수\nfunction cosineSimilarity(vecA, vecB) {\n    if (vecA.length !== vecB.length) {\n        throw new Error(\"벡터 차원이 일치하지 않습니다.\");\n    }\n    let dotProduct = 0;\n    let normA = 0;\n    let normB = 0;\n    for(let i = 0; i < vecA.length; i++){\n        dotProduct += vecA[i] * vecB[i];\n        normA += vecA[i] * vecA[i];\n        normB += vecB[i] * vecB[i];\n    }\n    if (normA === 0 || normB === 0) {\n        return 0;\n    }\n    return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));\n}\n// 배치로 임베딩 생성 및 저장\nasync function processChunksWithEmbeddings(chunks, documentId) {\n    try {\n        const supabase = (0,_supabase__WEBPACK_IMPORTED_MODULE_1__.getServerSupabaseClient)();\n        // 배치 크기 설정 (API 제한 고려)\n        const batchSize = 50;\n        const totalBatches = Math.ceil(chunks.length / batchSize);\n        console.log(`${chunks.length}개 청크를 ${totalBatches}개 배치로 처리`);\n        for(let i = 0; i < chunks.length; i += batchSize){\n            const batch = chunks.slice(i, i + batchSize);\n            const batchNumber = Math.floor(i / batchSize) + 1;\n            console.log(`배치 ${batchNumber}/${totalBatches} 처리 중... (${batch.length}개 청크)`);\n            try {\n                // 텍스트 추출\n                const texts = batch.map((chunk)=>chunk.text);\n                // 임베딩 생성\n                const embeddings = await generateEmbeddings(texts);\n                // 데이터베이스에 저장\n                const chunksToInsert = batch.map((chunk, index)=>({\n                        document_id: documentId,\n                        chunk_text: chunk.text,\n                        chunk_index: chunk.chunkIndex,\n                        metadata: chunk.metadata,\n                        embedding: embeddings[index] // 벡터 임베딩 저장\n                    }));\n                const { error: insertError } = await supabase.from(\"document_chunks\").insert(chunksToInsert);\n                if (insertError) {\n                    console.error(`배치 ${batchNumber} 저장 오류:`, insertError);\n                } else {\n                    console.log(`배치 ${batchNumber} 저장 완료`);\n                }\n                // API 제한을 위한 지연\n                if (batchNumber < totalBatches) {\n                    await new Promise((resolve)=>setTimeout(resolve, 1000));\n                }\n            } catch (batchError) {\n                console.error(`배치 ${batchNumber} 처리 오류:`, batchError);\n            }\n        }\n        console.log(\"모든 청크 임베딩 처리 완료\");\n    } catch (error) {\n        console.error(\"청크 임베딩 처리 오류:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFjSCxjQUFjO29CQUM5QixNQUFNLElBQUljLFFBQVFDLENBQUFBLFVBQVdDLFdBQVdELFNBQVM7Z0JBQ25EO1lBRUYsRUFBRSxPQUFPRSxZQUFZO2dCQUNuQi9ELFFBQVFNLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRTJDLFlBQVksT0FBTyxDQUFDLEVBQUVjO1lBQzVDO1FBQ0Y7UUFFQS9ELFFBQVFDLEdBQUcsQ0FBQztJQUVkLEVBQUUsT0FBT0ssT0FBTztRQUNkTixRQUFRTSxLQUFLLENBQUMsaUJBQWlCQTtRQUMvQixNQUFNQTtJQUNSO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haWVld2EvLi9saWIvZW1iZWRkaW5ncy50cz9hZWZhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9wZW5BSUVtYmVkZGluZ3MgfSBmcm9tICdAbGFuZ2NoYWluL29wZW5haSdcclxuaW1wb3J0IHsgZ2V0U2VydmVyU3VwYWJhc2VDbGllbnQgfSBmcm9tICcuL3N1cGFiYXNlJ1xyXG5cclxuLy8gT3BlbkFJIEVtYmVkZGluZ3Mg7YG065287J207Ja47Yq4IOy0iOq4sO2ZlFxyXG5sZXQgZW1iZWRkaW5nc0NsaWVudDogT3BlbkFJRW1iZWRkaW5ncyB8IG51bGwgPSBudWxsXHJcblxyXG5mdW5jdGlvbiBnZXRFbWJlZGRpbmdzQ2xpZW50KCk6IE9wZW5BSUVtYmVkZGluZ3Mge1xyXG4gIGlmICghZW1iZWRkaW5nc0NsaWVudCkge1xyXG4gICAgaWYgKCFwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ09QRU5BSV9BUElfS0VZIO2ZmOqyvSDrs4DsiJjqsIAg7ISk7KCV65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBlbWJlZGRpbmdzQ2xpZW50ID0gbmV3IE9wZW5BSUVtYmVkZGluZ3Moe1xyXG4gICAgICBvcGVuQUlBcGlLZXk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZLFxyXG4gICAgICBtb2RlbE5hbWU6ICd0ZXh0LWVtYmVkZGluZy0zLXNtYWxsJywgLy8g67mE7JqpIO2aqOycqOyggeyduCDrqqjrjbgg7IKs7JqpXHJcbiAgICAgIGJhdGNoU2l6ZTogMTAwLCAvLyDrsLDsuZgg7LKY66as66GcIEFQSSDtmLjstpwg7LWc7KCB7ZmUXHJcbiAgICB9KVxyXG4gIH1cclxuICBcclxuICByZXR1cm4gZW1iZWRkaW5nc0NsaWVudFxyXG59XHJcblxyXG4vLyDthY3siqTtirgg7LKt7YGs65Ok7J2EIOuyoe2EsCDsnoTrsqDrlKnsnLzroZwg67OA7ZmYXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUVtYmVkZGluZ3ModGV4dHM6IHN0cmluZ1tdKTogUHJvbWlzZTxudW1iZXJbXVtdPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKGAke3RleHRzLmxlbmd0aH3qsJwg7YWN7Iqk7Yq47JeQIOuMgO2VnCDsnoTrsqDrlKkg7IOd7ISxIOyLnOyekWApXHJcbiAgICBcclxuICAgIGNvbnN0IGNsaWVudCA9IGdldEVtYmVkZGluZ3NDbGllbnQoKVxyXG4gICAgY29uc3QgZW1iZWRkaW5ncyA9IGF3YWl0IGNsaWVudC5lbWJlZERvY3VtZW50cyh0ZXh0cylcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coYOyehOuyoOuUqSDsg53shLEg7JmE66OMOiAke2VtYmVkZGluZ3MubGVuZ3RofeqwnCDrsqHthLBgKVxyXG4gICAgcmV0dXJuIGVtYmVkZGluZ3NcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign7J6E67Kg65SpIOyDneyEsSDsmKTrpZg6JywgZXJyb3IpXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYOyehOuyoOuUqSDsg53shLHsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+yVjCDsiJgg7JeG64qUIOyYpOulmCd9YClcclxuICB9XHJcbn1cclxuXHJcbi8vIOuLqOydvCDthY3siqTtirjsl5Ag64yA7ZWcIOuyoe2EsCDsnoTrsqDrlKkg7IOd7ISxXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVNpbmdsZUVtYmVkZGluZyh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcltdPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNsaWVudCA9IGdldEVtYmVkZGluZ3NDbGllbnQoKVxyXG4gICAgY29uc3QgZW1iZWRkaW5nID0gYXdhaXQgY2xpZW50LmVtYmVkUXVlcnkodGV4dClcclxuICAgIHJldHVybiBlbWJlZGRpbmdcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign64uo7J28IOyehOuyoOuUqSDsg53shLEg7Jik66WYOicsIGVycm9yKVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKGDsnoTrsqDrlKkg7IOd7ISx7JeQIOyLpO2MqO2WiOyKteuLiOuLpDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICfslYwg7IiYIOyXhuuKlCDsmKTrpZgnfWApXHJcbiAgfVxyXG59XHJcblxyXG4vLyDrsqHthLAg7Jyg7IKs64+EIOqygOyDiSAo7L2U7IKs7J24IOycoOyCrOuPhClcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlYXJjaFNpbWlsYXJWZWN0b3JzKFxyXG4gIHF1ZXJ5RW1iZWRkaW5nOiBudW1iZXJbXSxcclxuICBsaW1pdDogbnVtYmVyID0gMTAsXHJcbiAgdGhyZXNob2xkOiBudW1iZXIgPSAwLjdcclxuKTogUHJvbWlzZTxBcnJheTx7XHJcbiAgY2h1bmtfdGV4dDogc3RyaW5nXHJcbiAgbWV0YWRhdGE6IGFueVxyXG4gIHNpbWlsYXJpdHk6IG51bWJlclxyXG59Pj4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFNlcnZlclN1cGFiYXNlQ2xpZW50KClcclxuICAgIFxyXG4gICAgLy8g66qo65OgIOyyre2BrOydmCDsnoTrsqDrlKnsnYQg6rCA7KC47JmA7IScIOycoOyCrOuPhCDqs4TsgrBcclxuICAgIGNvbnN0IHsgZGF0YTogY2h1bmtzLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2RvY3VtZW50X2NodW5rcycpXHJcbiAgICAgIC5zZWxlY3QoJ2NodW5rX3RleHQsIG1ldGFkYXRhLCBlbWJlZGRpbmcnKVxyXG4gICAgICAubm90KCdlbWJlZGRpbmcnLCAnaXMnLCBudWxsKVxyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign7LKt7YGsIOyhsO2ajCDsmKTrpZg6JywgZXJyb3IpXHJcbiAgICAgIHJldHVybiBbXVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoIWNodW5rcyB8fCBjaHVua3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfsnoTrsqDrlKnrkJwg7LKt7YGs6rCAIOyXhuyKteuLiOuLpC4nKVxyXG4gICAgICByZXR1cm4gW11cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g7L2U7IKs7J24IOycoOyCrOuPhCDqs4TsgrBcclxuICAgIGNvbnN0IHNpbWlsYXJpdGllcyA9IGNodW5rcy5tYXAoY2h1bmsgPT4ge1xyXG4gICAgICBpZiAoIWNodW5rLmVtYmVkZGluZyB8fCAhQXJyYXkuaXNBcnJheShjaHVuay5lbWJlZGRpbmcpKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgLi4uY2h1bmssIHNpbWlsYXJpdHk6IDAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBzaW1pbGFyaXR5ID0gY29zaW5lU2ltaWxhcml0eShxdWVyeUVtYmVkZGluZywgY2h1bmsuZW1iZWRkaW5nKVxyXG4gICAgICByZXR1cm4geyAuLi5jaHVuaywgc2ltaWxhcml0eSB9XHJcbiAgICB9KVxyXG4gICAgXHJcbiAgICAvLyDsnKDsgqzrj4Qg7Iic7Jy866GcIOygleugrO2VmOqzoCDsnoTqs4TqsJIg7J207IOB66eMIOuwmO2ZmFxyXG4gICAgY29uc3QgcmVzdWx0cyA9IHNpbWlsYXJpdGllc1xyXG4gICAgICAuZmlsdGVyKGl0ZW0gPT4gaXRlbS5zaW1pbGFyaXR5ID49IHRocmVzaG9sZClcclxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIuc2ltaWxhcml0eSAtIGEuc2ltaWxhcml0eSlcclxuICAgICAgLnNsaWNlKDAsIGxpbWl0KVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhg67Kh7YSwIOqygOyDiSDqsrDqs7w6ICR7cmVzdWx0cy5sZW5ndGh96rCcICjsnoTqs4TqsJI6ICR7dGhyZXNob2xkfSlgKVxyXG4gICAgcmV0dXJuIHJlc3VsdHNcclxuICAgIFxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfrsqHthLAg6rKA7IOJIOyYpOulmDonLCBlcnJvcilcclxuICAgIHJldHVybiBbXVxyXG4gIH1cclxufVxyXG5cclxuLy8g7L2U7IKs7J24IOycoOyCrOuPhCDqs4TsgrAg7ZWo7IiYXHJcbmZ1bmN0aW9uIGNvc2luZVNpbWlsYXJpdHkodmVjQTogbnVtYmVyW10sIHZlY0I6IG51bWJlcltdKTogbnVtYmVyIHtcclxuICBpZiAodmVjQS5sZW5ndGggIT09IHZlY0IubGVuZ3RoKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ+uyoe2EsCDssKjsm5DsnbQg7J287LmY7ZWY7KeAIOyViuyKteuLiOuLpC4nKVxyXG4gIH1cclxuICBcclxuICBsZXQgZG90UHJvZHVjdCA9IDBcclxuICBsZXQgbm9ybUEgPSAwXHJcbiAgbGV0IG5vcm1CID0gMFxyXG4gIFxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdmVjQS5sZW5ndGg7IGkrKykge1xyXG4gICAgZG90UHJvZHVjdCArPSB2ZWNBW2ldICogdmVjQltpXVxyXG4gICAgbm9ybUEgKz0gdmVjQVtpXSAqIHZlY0FbaV1cclxuICAgIG5vcm1CICs9IHZlY0JbaV0gKiB2ZWNCW2ldXHJcbiAgfVxyXG4gIFxyXG4gIGlmIChub3JtQSA9PT0gMCB8fCBub3JtQiA9PT0gMCkge1xyXG4gICAgcmV0dXJuIDBcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIGRvdFByb2R1Y3QgLyAoTWF0aC5zcXJ0KG5vcm1BKSAqIE1hdGguc3FydChub3JtQikpXHJcbn1cclxuXHJcbi8vIOuwsOy5mOuhnCDsnoTrsqDrlKkg7IOd7ISxIOuwjyDsoIDsnqVcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NDaHVua3NXaXRoRW1iZWRkaW5ncyhcclxuICBjaHVua3M6IEFycmF5PHtcclxuICAgIHRleHQ6IHN0cmluZ1xyXG4gICAgbWV0YWRhdGE6IGFueVxyXG4gICAgY2h1bmtJbmRleDogbnVtYmVyXHJcbiAgfT4sXHJcbiAgZG9jdW1lbnRJZDogc3RyaW5nXHJcbik6IFByb21pc2U8dm9pZD4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFNlcnZlclN1cGFiYXNlQ2xpZW50KClcclxuICAgIFxyXG4gICAgLy8g67Cw7LmYIO2BrOq4sCDshKTsoJUgKEFQSSDsoJztlZwg6rOg66CkKVxyXG4gICAgY29uc3QgYmF0Y2hTaXplID0gNTBcclxuICAgIGNvbnN0IHRvdGFsQmF0Y2hlcyA9IE1hdGguY2VpbChjaHVua3MubGVuZ3RoIC8gYmF0Y2hTaXplKVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhgJHtjaHVua3MubGVuZ3RofeqwnCDssq3tgazrpbwgJHt0b3RhbEJhdGNoZXN96rCcIOuwsOy5mOuhnCDsspjrpqxgKVxyXG4gICAgXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNodW5rcy5sZW5ndGg7IGkgKz0gYmF0Y2hTaXplKSB7XHJcbiAgICAgIGNvbnN0IGJhdGNoID0gY2h1bmtzLnNsaWNlKGksIGkgKyBiYXRjaFNpemUpXHJcbiAgICAgIGNvbnN0IGJhdGNoTnVtYmVyID0gTWF0aC5mbG9vcihpIC8gYmF0Y2hTaXplKSArIDFcclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGDrsLDsuZggJHtiYXRjaE51bWJlcn0vJHt0b3RhbEJhdGNoZXN9IOyymOumrCDspJEuLi4gKCR7YmF0Y2gubGVuZ3RofeqwnCDssq3tgawpYClcclxuICAgICAgXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgLy8g7YWN7Iqk7Yq4IOy2lOy2nFxyXG4gICAgICAgIGNvbnN0IHRleHRzID0gYmF0Y2gubWFwKGNodW5rID0+IGNodW5rLnRleHQpXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8g7J6E67Kg65SpIOyDneyEsVxyXG4gICAgICAgIGNvbnN0IGVtYmVkZGluZ3MgPSBhd2FpdCBnZW5lcmF0ZUVtYmVkZGluZ3ModGV4dHMpXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8g642w7J207YSw67Kg7J207Iqk7JeQIOyggOyepVxyXG4gICAgICAgIGNvbnN0IGNodW5rc1RvSW5zZXJ0ID0gYmF0Y2gubWFwKChjaHVuaywgaW5kZXgpID0+ICh7XHJcbiAgICAgICAgICBkb2N1bWVudF9pZDogZG9jdW1lbnRJZCxcclxuICAgICAgICAgIGNodW5rX3RleHQ6IGNodW5rLnRleHQsXHJcbiAgICAgICAgICBjaHVua19pbmRleDogY2h1bmsuY2h1bmtJbmRleCxcclxuICAgICAgICAgIG1ldGFkYXRhOiBjaHVuay5tZXRhZGF0YSxcclxuICAgICAgICAgIGVtYmVkZGluZzogZW1iZWRkaW5nc1tpbmRleF0gLy8g67Kh7YSwIOyehOuyoOuUqSDsoIDsnqVcclxuICAgICAgICB9KSlcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCB7IGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdkb2N1bWVudF9jaHVua3MnKVxyXG4gICAgICAgICAgLmluc2VydChjaHVua3NUb0luc2VydClcclxuICAgICAgICBcclxuICAgICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOuwsOy5mCAke2JhdGNoTnVtYmVyfSDsoIDsnqUg7Jik66WYOmAsIGluc2VydEVycm9yKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhg67Cw7LmYICR7YmF0Y2hOdW1iZXJ9IOyggOyepSDsmYTro4xgKVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBBUEkg7KCc7ZWc7J2EIOychO2VnCDsp4Dsl7BcclxuICAgICAgICBpZiAoYmF0Y2hOdW1iZXIgPCB0b3RhbEJhdGNoZXMpIHtcclxuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSlcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgIH0gY2F0Y2ggKGJhdGNoRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGDrsLDsuZggJHtiYXRjaE51bWJlcn0g7LKY66asIOyYpOulmDpgLCBiYXRjaEVycm9yKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKCfrqqjrk6Ag7LKt7YGsIOyehOuyoOuUqSDsspjrpqwg7JmE66OMJylcclxuICAgIFxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfssq3tgawg7J6E67Kg65SpIOyymOumrCDsmKTrpZg6JywgZXJyb3IpXHJcbiAgICB0aHJvdyBlcnJvclxyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiT3BlbkFJRW1iZWRkaW5ncyIsImdldFNlcnZlclN1cGFiYXNlQ2xpZW50IiwiZW1iZWRkaW5nc0NsaWVudCIsImdldEVtYmVkZGluZ3NDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJFcnJvciIsIm9wZW5BSUFwaUtleSIsIm1vZGVsTmFtZSIsImJhdGNoU2l6ZSIsImdlbmVyYXRlRW1iZWRkaW5ncyIsInRleHRzIiwiY29uc29sZSIsImxvZyIsImxlbmd0aCIsImNsaWVudCIsImVtYmVkZGluZ3MiLCJlbWJlZERvY3VtZW50cyIsImVycm9yIiwibWVzc2FnZSIsImdlbmVyYXRlU2luZ2xlRW1iZWRkaW5nIiwidGV4dCIsImVtYmVkZGluZyIsImVtYmVkUXVlcnkiLCJzZWFyY2hTaW1pbGFyVmVjdG9ycyIsInF1ZXJ5RW1iZWRkaW5nIiwibGltaXQiLCJ0aHJlc2hvbGQiLCJzdXBhYmFzZSIsImRhdGEiLCJjaHVua3MiLCJmcm9tIiwic2VsZWN0Iiwibm90Iiwic2ltaWxhcml0aWVzIiwibWFwIiwiY2h1bmsiLCJBcnJheSIsImlzQXJyYXkiLCJzaW1pbGFyaXR5IiwiY29zaW5lU2ltaWxhcml0eSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJpdGVtIiwic29ydCIsImEiLCJiIiwic2xpY2UiLCJ2ZWNBIiwidmVjQiIsImRvdFByb2R1Y3QiLCJub3JtQSIsIm5vcm1CIiwiaSIsIk1hdGgiLCJzcXJ0IiwicHJvY2Vzc0NodW5rc1dpdGhFbWJlZGRpbmdzIiwiZG9jdW1lbnRJZCIsInRvdGFsQmF0Y2hlcyIsImNlaWwiLCJiYXRjaCIsImJhdGNoTnVtYmVyIiwiZmxvb3IiLCJjaHVua3NUb0luc2VydCIsImluZGV4IiwiZG9jdW1lbnRfaWQiLCJjaHVua190ZXh0IiwiY2h1bmtfaW5kZXgiLCJjaHVua0luZGV4IiwibWV0YWRhdGEiLCJpbnNlcnRFcnJvciIsImluc2VydCIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImJhdGNoRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/embeddings.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getClientSupabaseClient: () => (/* binding */ getClientSupabaseClient),\n/* harmony export */   getServerSupabaseClient: () => (/* binding */ getServerSupabaseClient),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   supabaseClient: () => (/* binding */ supabaseClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Function to get supabase client at runtime (for API routes)\nfunction getServerSupabaseClient() {\n    const url = \"https://puajxghokhribumtxrby.supabase.co\";\n    const key = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!url || !key) {\n        const missingVars = [];\n        if (!url) missingVars.push(\"NEXT_PUBLIC_SUPABASE_URL\");\n        if (!key) missingVars.push(\"SUPABASE_SERVICE_ROLE_KEY\");\n        throw new Error(`Missing Supabase environment variables: ${missingVars.join(\", \")}`);\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, key);\n}\n// Function to get anon client at runtime (for client-side usage)  \nfunction getClientSupabaseClient() {\n    const url = \"https://puajxghokhribumtxrby.supabase.co\";\n    const key = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n    if (!url || !key) {\n        throw new Error(\"Missing Supabase environment variables\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, key);\n}\n// Placeholder exports for build-time compatibility\nconst supabase = {};\nconst supabaseClient = {};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBb0Q7QUFFcEQsOERBQThEO0FBQ3ZELFNBQVNDO0lBQ2QsTUFBTUMsTUFBTUMsMENBQW9DO0lBQ2hELE1BQU1HLE1BQU1ILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0lBRWpELElBQUksQ0FBQ0wsT0FBTyxDQUFDSSxLQUFLO1FBQ2hCLE1BQU1FLGNBQWMsRUFBRTtRQUN0QixJQUFJLENBQUNOLEtBQUtNLFlBQVlDLElBQUksQ0FBQztRQUMzQixJQUFJLENBQUNILEtBQUtFLFlBQVlDLElBQUksQ0FBQztRQUMzQixNQUFNLElBQUlDLE1BQU0sQ0FBQyx3Q0FBd0MsRUFBRUYsWUFBWUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNyRjtJQUVBLE9BQU9YLG1FQUFZQSxDQUFDRSxLQUFLSTtBQUMzQjtBQUVBLG1FQUFtRTtBQUM1RCxTQUFTTTtJQUNkLE1BQU1WLE1BQU1DLDBDQUFvQztJQUNoRCxNQUFNRyxNQUFNSCxRQUFRQyxHQUFHLENBQUNTLDZCQUE2QjtJQUVyRCxJQUFJLENBQUNYLE9BQU8sQ0FBQ0ksS0FBSztRQUNoQixNQUFNLElBQUlJLE1BQU07SUFDbEI7SUFFQSxPQUFPVixtRUFBWUEsQ0FBQ0UsS0FBS0k7QUFDM0I7QUFFQSxtREFBbUQ7QUFDNUMsTUFBTVEsV0FBVyxDQUFDLEVBQVE7QUFDMUIsTUFBTUMsaUJBQWlCLENBQUMsRUFBUSIsInNvdXJjZXMiOlsid2VicGFjazovL2FpZWV3YS8uL2xpYi9zdXBhYmFzZS50cz9jOTlmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcydcclxuXHJcbi8vIEZ1bmN0aW9uIHRvIGdldCBzdXBhYmFzZSBjbGllbnQgYXQgcnVudGltZSAoZm9yIEFQSSByb3V0ZXMpXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRTZXJ2ZXJTdXBhYmFzZUNsaWVudCgpIHtcclxuICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkxcclxuICBjb25zdCBrZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZXHJcbiAgXHJcbiAgaWYgKCF1cmwgfHwgIWtleSkge1xyXG4gICAgY29uc3QgbWlzc2luZ1ZhcnMgPSBbXVxyXG4gICAgaWYgKCF1cmwpIG1pc3NpbmdWYXJzLnB1c2goJ05FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCcpXHJcbiAgICBpZiAoIWtleSkgbWlzc2luZ1ZhcnMucHVzaCgnU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWScpXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgU3VwYWJhc2UgZW52aXJvbm1lbnQgdmFyaWFibGVzOiAke21pc3NpbmdWYXJzLmpvaW4oJywgJyl9YClcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIGNyZWF0ZUNsaWVudCh1cmwsIGtleSlcclxufVxyXG5cclxuLy8gRnVuY3Rpb24gdG8gZ2V0IGFub24gY2xpZW50IGF0IHJ1bnRpbWUgKGZvciBjbGllbnQtc2lkZSB1c2FnZSkgIFxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpZW50U3VwYWJhc2VDbGllbnQoKSB7XHJcbiAgY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMXHJcbiAgY29uc3Qga2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVlcclxuICBcclxuICBpZiAoIXVybCB8fCAha2V5KSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgU3VwYWJhc2UgZW52aXJvbm1lbnQgdmFyaWFibGVzJylcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIGNyZWF0ZUNsaWVudCh1cmwsIGtleSlcclxufVxyXG5cclxuLy8gUGxhY2Vob2xkZXIgZXhwb3J0cyBmb3IgYnVpbGQtdGltZSBjb21wYXRpYmlsaXR5XHJcbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IHt9IGFzIGFueVxyXG5leHBvcnQgY29uc3Qgc3VwYWJhc2VDbGllbnQgPSB7fSBhcyBhbnlcclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsImdldFNlcnZlclN1cGFiYXNlQ2xpZW50IiwidXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsImtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJtaXNzaW5nVmFycyIsInB1c2giLCJFcnJvciIsImpvaW4iLCJnZXRDbGllbnRTdXBhYmFzZUNsaWVudCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwic3VwYWJhc2UiLCJzdXBhYmFzZUNsaWVudCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/whatwg-url","vendor-chunks/tr46","vendor-chunks/pdf-parse","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpreprocess-pdfs%2Froute&page=%2Fapi%2Fpreprocess-pdfs%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpreprocess-pdfs%2Froute.ts&appDir=C%3A%5CUsers%5C%EA%B9%80%EB%AF%BC%EC%A0%9C%5CDocuments%5CDev%5Caieewa%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5C%EA%B9%80%EB%AF%BC%EC%A0%9C%5CDocuments%5CDev%5Caieewa&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();